---
- name: Creating EC2 Image Launcher
  hosts: localhost
  connection: local
  gather_facts: False
  tasks:
  - name: Launching EC2
    ec2:
      instance_type: t2.micro
      key_name: ansible-skylight-ncal
      image: ami-00fc224d9834053d6
      region: us-west-1
      group: insecure_all
      count: 1
      instance_tags:
        web: apache
      vpc_subnet_id: subnet-02b14a5a
      wait: yes
      assign_public_ip: yes
      
  - name: wait for ssh to come up
    delegate_to "{{ item.public_dns_name }}"
    wait_for_connection:
      delay: 60
      timeout: 320
    loop: "{{ ec2.instances }}"
